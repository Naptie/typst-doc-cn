



<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>State – Typst 中文文档</title>
  <meta name="description" content="State 类型的文档">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#239dad">
  <meta property="og:url" content="https://typst-doc-cn.github.io/docs/reference/introspection/state/">
  <meta property="og:title" content="State – Typst 中文文档">
  <meta property="og:site_name" content="Typst">
  <meta property="og:description" content="State 类型的文档">
  <meta property="og:type">
  <meta property="og:image" content="https://typst-doc-cn.github.io/assets/social.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta name="twitter:site" content="@typstapp">
  <meta name="twitter:card" content="summary_large_image">
  <link rel="canonical" href="https://typst-doc-cn.github.io/docs/reference/introspection/state/">
  <meta name="twitter:image:alt"
    content="The left side of a text editor with colorful cursors, as well as the text &#x27;Compose papers faster, Typst&#x27;">
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon.ico">
  <!-- <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon.ico"> -->
  <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
  <link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#239dad">
  <link rel="manifest" href="/assets/site.webmanifest">
  <link rel="stylesheet" href="/styles/default.css?bust=20230913?d=2023-09-16">
  <link rel="stylesheet" href="/styles/docs.css?bust=20230915?d=2023-09-16">
  <link rel="stylesheet" href="/styles/docs-cn.css">
  <link rel="preload" href="/assets/fonts/HKGrotesk-Regular.woff2" as="font">
  <link rel="preload" href="/assets/fonts/HKGrotesk-Bold.woff2" as="font">
  <link rel="preload" href="/assets/fonts/HKGrotesk-SemiBold.woff2" as="font">
  <link rel="preload" href="/assets/fonts/CascadiaMono-Regular-Sub.woff2" as="font">
  <link rel="preload" href="/assets/images/blur.webp" as="image">
  
  <script>document.documentElement.className = document.documentElement.className.replace("no-js", "js"), document.addEventListener("DOMContentLoaded", (() => { const e = document.cookie.split("; ").find((e => e.startsWith("INSECURE_SIGNED_IN=")))?.split("=")[1].toLowerCase(); if ("1" === e || "true" === e || "yes" === e) { document.documentElement.classList.add("signed-in"); const e = document.querySelector("header nav a.nav-btn"), t = document.querySelector("header nav a.sign-in"); e && (e.innerHTML = "Go to app", e.setAttribute("href", "/app/")), t && (t.innerHTML = "Sign out", t.setAttribute("href", "https://api.typst.app/v1/auth/logout")) } }))</script>
</head>

<body class="no-js docs has-outline">
  <div class="alert">
    <div class="alert-content">
      <span><b>注意：</b>该中文文档为社区驱动的非官网文档，可能存在错译、漏译或过时等问题，请以官网文档 <a href="https://typst.app/docs/">Documentation</a>
        为准，如发现错漏，也欢迎 <a href="https://github.com/typst-doc-cn/typst-doc-cn.github.io">您的贡献</a>（<a href="https://gitee.com/orangex4/typst-doc-cn.github.io">镜像</a>）。Typst 非官方中文交流 QQ 群：793548390</span>
      <br />
      <span><b>Warning:</b> the Chinese document is a community-driven non-official document, there may be mistranslation, omission or outdated problems, please refer to <a href="https://typst.app/docs/">the official website documentation</a>.</span>
    </div>
  </div>
  <header class="boring">
    <div><a href="/docs" class="logo-box"><svg width="91" height="35" viewBox="0 0 91 35" role="img"
          aria-labelledby="logo-label">
          <title id="logo-label">Typst</title>
          <use href="/assets/images/typst.svg#logo"></use>
        </svg><span>中文文档</span></a><button class="hamburger"><img alt="Open navigation"
          src="/assets/icons/16-hamburger-dark.svg" width="16" height="16"></button>
      <nav>
        <ul>
          <li class="social"><a href="https://twitter.com/typstapp/"><svg width="16" height="16" role="img"
                aria-labelledby="svg-twitter-label">
                <title id="svg-twitter-label">Twitter</title>
                <use href="/assets/icons/social.svg#twitter"></use>
              </svg></a></li>
          <li class="social"><a href="https://discord.gg/2uDybryKPe"><svg width="16" height="16" role="img"
                aria-labelledby="svg-discord-label">
                <title id="svg-discord-label">Discord</title>
                <use href="/assets/icons/social.svg#discord"></use>
              </svg></a></li>
          <li class="social"><a href="https://github.com/typst-doc-cn/typst-doc-cn.github.io"><svg width="16" height="16" role="img"
                aria-labelledby="svg-github-label">
                <title id="svg-github-label">GitHub</title>
                <use href="/assets/icons/social.svg#github"></use>
              </svg></a></li>
          <li class="social"><a href="https://www.linkedin.com/company/typst/"><svg width="16" height="16" role="img"
                aria-labelledby="svg-linkedin-label">
                <title id="svg-linkedin-label">LinkedIn</title>
                <use href="/assets/icons/social.svg#linkedin"></use>
              </svg></a></li>
          <li class="secondary"><a href="https://typst.app/">主页</a></li>
          <!-- <li class="secondary"><a href="/signin/" class="sign-in">Sign in</a></li>
          <li><a href="/signup" id="header-btn" class="nav-btn btn">Sign up</a></li> -->
        </ul>
      </nav>
    </div>
  </header>
  <div class="main-grid">
    <nav class="folding"><a href="/docs" class="title-row"><svg width="91" height="35" viewBox="0 0 91 35" role="img"
          aria-labelledby="logo-label-nav">
          <title id="logo-label-nav">Typst</title>
          <use href="/assets/images/typst.svg#logo"></use>
        </svg><span>中文文档</span></a>
      <button class="close"><img alt="Close" src="/assets/icons/16-close-dark.svg"
          width="16" height="16"></button>
      <div class="search"><img src="/assets/icons/16-search-gray.svg" alt="Search" width="16" height="16"><input
          type="search" placeholder="搜索" id="docs-search"></div>
      <ul class="search-results hidden" id="search-results"></ul>
      <ul>
        
        
        <li>
          <a href="/docs/" >概览</a>
          
        </li>
        
        
        <li>
          <a href="/docs/tutorial/" >教程</a>
          
          <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
          <ul>
            
            
            <li>
              <a href="/docs/tutorial/writing-in-typst/" >使用 Typst 写作</a>
              
            </li>
            
            
            <li>
              <a href="/docs/tutorial/formatting/" >格式</a>
              
            </li>
            
            
            <li>
              <a href="/docs/tutorial/advanced-styling/" >高级样式</a>
              
            </li>
            
            
            <li>
              <a href="/docs/tutorial/making-a-template/" >制作模板</a>
              
            </li>
            
          </ul>
          
        </li>
        
        
        <li>
          <a href="/docs/chinese/" >中文用户指南</a>
          
        </li>
        
        
        <li>
          <a href="/docs/reference/" >参考</a>
          
          <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
          <ul>
            
            
            
            <li class="category">Language</li>
            
            <li>
              <a href="/docs/reference/syntax/" >语法</a>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/styling/" >样式</a>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/scripting/" >脚本</a>
              
            </li>
            
            
            
            
            <li>
              <a href="/docs/reference/types/" >类型（旧）</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/types/none/" >None</a></li>
                
                
                <li><a href="/docs/reference/types/auto/" >Auto</a></li>
                
                
                <li><a href="/docs/reference/types/boolean/" >Boolean</a></li>
                
                
                <li><a href="/docs/reference/types/integer/" >Integer</a></li>
                
                
                <li><a href="/docs/reference/types/float/" >Float</a></li>
                
                
                <li><a href="/docs/reference/types/length/" >Length</a></li>
                
                
                <li><a href="/docs/reference/types/angle/" >Angle</a></li>
                
                
                <li><a href="/docs/reference/types/ratio/" >Ratio</a></li>
                
                
                <li><a href="/docs/reference/types/relative-length/" >Relative Length</a></li>
                
                
                <li><a href="/docs/reference/types/fraction/" >Fraction</a></li>
                
                
                <li><a href="/docs/reference/types/color/" >Color</a></li>
                
                
                <li><a href="/docs/reference/types/datetime/" >Datetime</a></li>
                
                
                <li><a href="/docs/reference/types/symbol/" >Symbol</a></li>
                
                
                <li><a href="/docs/reference/types/string/" >String</a></li>
                
                
                <li><a href="/docs/reference/types/content/" >Content</a></li>
                
                
                <li><a href="/docs/reference/types/array/" >Array</a></li>
                
                
                <li><a href="/docs/reference/types/dictionary/" >Dictionary</a></li>
                
                
                <li><a href="/docs/reference/types/function/" >Function</a></li>
                
                
                <li><a href="/docs/reference/types/arguments/" >Arguments</a></li>
                
                
                <li><a href="/docs/reference/types/selector/" >Selector</a></li>
                
                
                <li><a href="/docs/reference/types/module/" >Module</a></li>
                
              </ul>
              
            </li>

            
            <li class="category">Library</li>
            
            <li>
              <a href="/docs/reference/foundations/" >基础</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/foundations/arguments/" >Arguments</a></li>
                
                
                <li><a href="/docs/reference/foundations/array/" >Array</a></li>
                
                
                <li><a href="/docs/reference/foundations/assert/" >Assert</a></li>
                
                
                <li><a href="/docs/reference/foundations/bool/" >Boolean</a></li>
                
                
                <li><a href="/docs/reference/foundations/bytes/" >Bytes</a></li>
                
                
                <li><a href="/docs/reference/foundations/content/" >Content</a></li>
                
                
                <li><a href="/docs/reference/foundations/datetime/" >Datetime</a></li>
                
                
                <li><a href="/docs/reference/foundations/dictionary/" >Dictionary</a></li>
                
                
                <li><a href="/docs/reference/foundations/duration/" >Duration</a></li>
                
                
                <li><a href="/docs/reference/foundations/eval/" >Evaluate</a></li>
                
                
                <li><a href="/docs/reference/foundations/float/" >Float</a></li>
                
                
                <li><a href="/docs/reference/foundations/function/" >Function</a></li>
                
                
                <li><a href="/docs/reference/foundations/int/" >Integer</a></li>
                
                
                <li><a href="/docs/reference/foundations/label/" >Label</a></li>
                
                
                <li><a href="/docs/reference/foundations/module/" >Module</a></li>
                
                
                <li><a href="/docs/reference/foundations/panic/" >Panic</a></li>
                
                
                <li><a href="/docs/reference/foundations/plugin/" >Plugin</a></li>
                
                
                <li><a href="/docs/reference/foundations/regex/" >Regex</a></li>
                
                
                <li><a href="/docs/reference/foundations/repr/" >Representation</a></li>
                
                
                <li><a href="/docs/reference/foundations/selector/" >Selector</a></li>
                
                
                <li><a href="/docs/reference/foundations/str/" >String</a></li>
                
                
                <li><a href="/docs/reference/foundations/style/" >Style</a></li>
                
                
                <li><a href="/docs/reference/foundations/type/" >Type</a></li>
                
                
                <li><a href="/docs/reference/foundations/version/" >Version</a></li>
                
                
                <li><a href="/docs/reference/foundations/sys" >System</a></li>
                
                
                <li><a href="/docs/reference/foundations/calc" >Calculation</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/model/" >模型</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/model/bibliography/" >Bibliography</a></li>
                
                
                <li><a href="/docs/reference/model/list/" >Bullet List</a></li>
                
                
                <li><a href="/docs/reference/model/cite/" >Cite</a></li>
                
                
                <li><a href="/docs/reference/model/document/" >Document</a></li>
                
                
                <li><a href="/docs/reference/model/emph/" >Emphasis</a></li>
                
                
                <li><a href="/docs/reference/model/figure/" >Figure</a></li>
                
                
                <li><a href="/docs/reference/model/footnote/" >Footnote</a></li>
                
                
                <li><a href="/docs/reference/model/heading/" >Heading</a></li>
                
                
                <li><a href="/docs/reference/model/link/" >Link</a></li>
                
                
                <li><a href="/docs/reference/model/enum/" >Numbered List</a></li>
                
                
                <li><a href="/docs/reference/model/numbering/" >Numbering</a></li>
                
                
                <li><a href="/docs/reference/model/outline/" >Outline</a></li>
                
                
                <li><a href="/docs/reference/model/par/" >Paragraph</a></li>
                
                
                <li><a href="/docs/reference/model/parbreak/" >Paragraph Break</a></li>
                
                
                <li><a href="/docs/reference/model/quote/" >Quote</a></li>
                
                
                <li><a href="/docs/reference/model/ref/" >Reference</a></li>
                
                
                <li><a href="/docs/reference/model/strong/" >Strong Emphasis</a></li>
                
                
                <li><a href="/docs/reference/model/table/" >Table</a></li>
                
                
                <li><a href="/docs/reference/model/terms/" >Term List</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/text/" >文本</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/text/highlight/" >文本高亮</a></li>
                
                
                <li><a href="/docs/reference/text/linebreak/" >换行</a></li>
                
                
                <li><a href="/docs/reference/text/lorem/" >假文</a></li>
                
                
                <li><a href="/docs/reference/text/lower/" >转小写</a></li>
                
                
                <li><a href="/docs/reference/text/overline/" >上划线</a></li>
                
                
                <li><a href="/docs/reference/text/raw/" >原始文本/代码块</a></li>
                
                
                <li><a href="/docs/reference/text/smallcaps/" >显示为小写</a></li>
                
                
                <li><a href="/docs/reference/text/smartquote/" >智能引号</a></li>
                
                
                <li><a href="/docs/reference/text/strike/" >删除线</a></li>
                
                
                <li><a href="/docs/reference/text/sub/" >下标</a></li>
                
                
                <li><a href="/docs/reference/text/super/" >上标</a></li>
                
                
                <li><a href="/docs/reference/text/text/" >文本</a></li>
                
                
                <li><a href="/docs/reference/text/underline/" >下划线</a></li>
                
                
                <li><a href="/docs/reference/text/upper/" >转大写</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/math/" >数学</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/math/accent/" >重音符号</a></li>
                
                
                <li><a href="/docs/reference/math/cancel/" >删除线</a></li>
                
                
                <li><a href="/docs/reference/math/cases/" >左大括号</a></li>
                
                
                <li><a href="/docs/reference/math/class/" >类</a></li>
                
                
                <li><a href="/docs/reference/math/equation/" >数学表达式</a></li>
                
                
                <li><a href="/docs/reference/math/frac/" >分数</a></li>
                
                
                <li><a href="/docs/reference/math/mat/" >矩阵</a></li>
                
                
                <li><a href="/docs/reference/math/op/" >文本运算符</a></li>
                
                
                <li><a href="/docs/reference/math/vec/" >向量</a></li>
                
                
                <li><a href="/docs/reference/math/underover" >上/下方内容</a></li>
                
                
                <li><a href="/docs/reference/math/variants" >字体变体</a></li>
                
                
                <li><a href="/docs/reference/math/sizes" >显示尺寸</a></li>
                
                
                <li><a href="/docs/reference/math/lr" >Left/Right</a></li>
                
                
                <li><a href="/docs/reference/math/styles" >显示样式</a></li>
                
                
                <li><a href="/docs/reference/math/roots" >根式</a></li>
                
                
                <li><a href="/docs/reference/math/attach" >附缀</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/symbols/" >符号</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/symbols/sym/" >通用</a></li>
                
                
                <li><a href="/docs/reference/symbols/emoji/" >表情符号</a></li>
                
                
                <li><a href="/docs/reference/symbols/symbol/" >符号</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/layout/" >布局</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/layout/align/" >Align</a></li>
                
                
                <li><a href="/docs/reference/layout/alignment/" >Alignment</a></li>
                
                
                <li><a href="/docs/reference/layout/angle/" >Angle</a></li>
                
                
                <li><a href="/docs/reference/layout/block/" >Block</a></li>
                
                
                <li><a href="/docs/reference/layout/box/" >Box</a></li>
                
                
                <li><a href="/docs/reference/layout/colbreak/" >Column Break</a></li>
                
                
                <li><a href="/docs/reference/layout/columns/" >Columns</a></li>
                
                
                <li><a href="/docs/reference/layout/direction/" >Direction</a></li>
                
                
                <li><a href="/docs/reference/layout/fraction/" >Fraction</a></li>
                
                
                <li><a href="/docs/reference/layout/grid/" >Grid</a></li>
                
                
                <li><a href="/docs/reference/layout/hide/" >Hide</a></li>
                
                
                <li><a href="/docs/reference/layout/layout/" >Layout</a></li>
                
                
                <li><a href="/docs/reference/layout/length/" >Length</a></li>
                
                
                <li><a href="/docs/reference/layout/measure/" >Measure</a></li>
                
                
                <li><a href="/docs/reference/layout/move/" >Move</a></li>
                
                
                <li><a href="/docs/reference/layout/pad/" >Padding</a></li>
                
                
                <li><a href="/docs/reference/layout/page/" >Page</a></li>
                
                
                <li><a href="/docs/reference/layout/pagebreak/" >Page Break</a></li>
                
                
                <li><a href="/docs/reference/layout/place/" >Place</a></li>
                
                
                <li><a href="/docs/reference/layout/ratio/" >Ratio</a></li>
                
                
                <li><a href="/docs/reference/layout/relative/" >Relative Length</a></li>
                
                
                <li><a href="/docs/reference/layout/repeat/" >Repeat</a></li>
                
                
                <li><a href="/docs/reference/layout/rotate/" >Rotate</a></li>
                
                
                <li><a href="/docs/reference/layout/scale/" >Scale</a></li>
                
                
                <li><a href="/docs/reference/layout/h/" >Spacing (H)</a></li>
                
                
                <li><a href="/docs/reference/layout/v/" >Spacing (V)</a></li>
                
                
                <li><a href="/docs/reference/layout/stack/" >Stack</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/visualize/" >可视化</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/visualize/circle/" >Circle</a></li>
                
                
                <li><a href="/docs/reference/visualize/color/" >Color</a></li>
                
                
                <li><a href="/docs/reference/visualize/ellipse/" >Ellipse</a></li>
                
                
                <li><a href="/docs/reference/visualize/gradient/" >Gradient</a></li>
                
                
                <li><a href="/docs/reference/visualize/image/" >Image</a></li>
                
                
                <li><a href="/docs/reference/visualize/line/" >Line</a></li>
                
                
                <li><a href="/docs/reference/visualize/path/" >Path</a></li>
                
                
                <li><a href="/docs/reference/visualize/pattern/" >Pattern</a></li>
                
                
                <li><a href="/docs/reference/visualize/polygon/" >Polygon</a></li>
                
                
                <li><a href="/docs/reference/visualize/rect/" >Rectangle</a></li>
                
                
                <li><a href="/docs/reference/visualize/square/" >Square</a></li>
                
                
                <li><a href="/docs/reference/visualize/stroke/" >Stroke</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/introspection/" >内省</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/introspection/counter/" >Counter</a></li>
                
                
                <li><a href="/docs/reference/introspection/locate/" >Locate</a></li>
                
                
                <li><a href="/docs/reference/introspection/location/" >Location</a></li>
                
                
                <li><a href="/docs/reference/introspection/metadata/" >Metadata</a></li>
                
                
                <li><a href="/docs/reference/introspection/query/" >Query</a></li>
                
                
                <li><a href="/docs/reference/introspection/state/"  aria-current="page" >State</a></li>
                
              </ul>
              
            </li>
            
            
            <li>
              <a href="/docs/reference/data-loading/" >数据加载</a>
              
              <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
              <ul>
                
                
                <li><a href="/docs/reference/data-loading/cbor/" >CBOR</a></li>
                
                
                <li><a href="/docs/reference/data-loading/csv/" >CSV</a></li>
                
                
                <li><a href="/docs/reference/data-loading/json/" >JSON</a></li>
                
                
                <li><a href="/docs/reference/data-loading/read/" >Read</a></li>
                
                
                <li><a href="/docs/reference/data-loading/toml/" >TOML</a></li>
                
                
                <li><a href="/docs/reference/data-loading/xml/" >XML</a></li>
                
                
                <li><a href="/docs/reference/data-loading/yaml/" >YAML</a></li>
                
              </ul>
              
            </li>
            
          </ul>
          
        </li>
        
        
        <li>
          <a href="/docs/guides/" >指南</a>
          
          <button><img alt="Expand" src="/assets/icons/16-arrow-right.svg" width="16" height="16"></button>
          <ul>
            
            
            <li>
              <a href="/docs/guides/guide-for-latex-users/" >LaTeX 用户指南</a>
              
            </li>
            
            
            <li>
              <a href="/docs/guides/page-setup/" >页面设置指南</a>
              
            </li>
            
          </ul>
          
        </li>
        
        
        <li>
          <a href="/docs/packages/" >第三方包</a>
          
        </li>
        
        
        <li>
          <a href="/docs/changelog/" >更新日志</a>
          
        </li>
        
        
        <li>
          <a href="/docs/roadmap/" >路线图</a>
          
        </li>
        
        
        <li>
          <a href="/docs/community/" >社区</a>
          
        </li>
        
        
        <li>
          <a href="/docs/glossary/" >术语表</a>
          
        </li>
        
      </ul>

    </nav>
    <main>
      <ul class="breadcrumbs" aria-label="Breadcrumbs">
        <li class="root"><a href="/docs/"><img src="/assets/icons/16-docs-dark.svg" alt="Docs" width="16"
              height="16"></a></li>

        
        <li aria-hidden="true"><img src="/assets/icons/16-arrow-right.svg" width="16" height="16" alt=""></li>
        <li><a href="/docs/reference/">参考</a></li>
        
        <li aria-hidden="true"><img src="/assets/icons/16-arrow-right.svg" width="16" height="16" alt=""></li>
        <li><a href="/docs/reference/introspection/">内省</a></li>
        
        <li aria-hidden="true"><img src="/assets/icons/16-arrow-right.svg" width="16" height="16" alt=""></li>
        <li><a href="/docs/reference/introspection/state/">State</a></li>
        
      </ul>

      

<h1 id="summary"><span class="pill pill-obj">state</span></h1>
<p>Manages stateful parts of your document.</p>
<p>Let's say you have some computations in your document and want to remember
the result of your last computation to use it in the next one. You might try
something similar to the code below and expect it to output 10, 13, 26, and
21. However this <strong>does not work</strong> in Typst. If you test this code, you will
see that Typst complains with the following error message: <em>Variables from
outside the function are read-only and cannot be modified.</em></p>
<pre><code><span class="typ-key">#</span><span class="typ-key">let</span> x <span class="typ-op">=</span> <span class="typ-num">0</span>
<span class="typ-key">#</span><span class="typ-key">let</span> <span class="typ-func">compute</span><span class="typ-punct">(</span>expr<span class="typ-punct">)</span> <span class="typ-op">=</span> <span class="typ-punct">{</span>
  x <span class="typ-op">=</span> <span class="typ-func">eval</span><span class="typ-punct">(</span>
    expr<span class="typ-punct">.</span><span class="typ-func">replace</span><span class="typ-punct">(</span><span class="typ-str">&quot;x&quot;</span><span class="typ-punct">,</span> <span class="typ-func">str</span><span class="typ-punct">(</span>x<span class="typ-punct">)</span><span class="typ-punct">)</span>
  <span class="typ-punct">)</span>
  <span class="typ-punct">[</span>New value is <span class="typ-pol">#</span><span class="typ-pol">x</span>. <span class="typ-punct">]</span>
<span class="typ-punct">}</span>

<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;10&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x + 3&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x * 2&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x - 5&quot;</span><span class="typ-punct">)</span>
</code></pre>
<h2 id="state-and-markup">State and document markup</h2>
<p>Why does it do that? Because, in general, this kind of computation with side
effects is problematic in document markup and Typst is upfront about that.
For the results to make sense, the computation must proceed in the same
order in which the results will be laid out in the document. In our simple
example, that's the case, but in general it might not be.</p>
<p>Let's look at a slightly different, but similar kind of state: The heading
numbering. We want to increase the heading counter at each heading. Easy
enough, right? Just add one. Well, it's not that simple. Consider the
following example:</p>
<div class="previewed-code"><pre><code><span class="typ-key">#</span><span class="typ-key">set</span> <span class="typ-func">heading</span><span class="typ-punct">(</span>numbering<span class="typ-punct">:</span> <span class="typ-str">&quot;1.&quot;</span><span class="typ-punct">)</span>
<span class="typ-key">#</span><span class="typ-key">let</span> <span class="typ-func">template</span><span class="typ-punct">(</span>body<span class="typ-punct">)</span> <span class="typ-op">=</span> <span class="typ-punct">[</span>
  <span class="typ-heading">= Outline</span>
  <span class="typ-escape">...</span>
  <span class="typ-pol">#</span><span class="typ-pol">body</span>
<span class="typ-punct">]</span>

<span class="typ-key">#</span><span class="typ-key">show</span><span class="typ-punct">:</span> <span class="typ-func">template</span>

<span class="typ-heading">= Introduction</span>
<span class="typ-escape">...</span>
</code></pre><div class="preview"><img src="/assets/docs/fdcc5211e820e822853ff14684aaf58a.png" alt="Preview" width="480" height="190"/></div></div>
<p>Here, Typst first processes the body of the document after the show rule,
sees the <code>Introduction</code> heading, then passes the resulting content to the
<code>template</code> function and only then sees the <code>Outline</code>. Just counting up would
number the <code>Introduction</code> with <code>1</code> and the <code>Outline</code> with <code>2</code>.</p>
<h2 id="state-in-typst">Managing state in Typst</h2>
<p>So what do we do instead? We use Typst's state management system. Calling
the <code>state</code> function with an identifying string key and an optional initial
value gives you a state value which exposes a few methods. The two most
important ones are <code>display</code> and <code>update</code>:</p>
<ul>
<li>
<p>The <code>display</code> method shows the current value of the state. You can
optionally give it a function that receives the value and formats it in
some way.</p>
</li>
<li>
<p>The <code>update</code> method modifies the state. You can give it any value. If
given a non-function value, it sets the state to that value. If given a
function, that function receives the previous state and has to return the
new state.</p>
</li>
</ul>
<p>Our initial example would now look like this:</p>
<div class="previewed-code"><pre><code><span class="typ-key">#</span><span class="typ-key">let</span> s <span class="typ-op">=</span> <span class="typ-func">state</span><span class="typ-punct">(</span><span class="typ-str">&quot;x&quot;</span><span class="typ-punct">,</span> <span class="typ-num">0</span><span class="typ-punct">)</span>
<span class="typ-key">#</span><span class="typ-key">let</span> <span class="typ-func">compute</span><span class="typ-punct">(</span>expr<span class="typ-punct">)</span> <span class="typ-op">=</span> <span class="typ-punct">[</span>
  <span class="typ-pol">#</span><span class="typ-pol">s</span><span class="typ-punct">.</span><span class="typ-func">update</span><span class="typ-punct">(</span>x <span class="typ-op">=&gt;</span>
    <span class="typ-func">eval</span><span class="typ-punct">(</span>expr<span class="typ-punct">.</span><span class="typ-func">replace</span><span class="typ-punct">(</span><span class="typ-str">&quot;x&quot;</span><span class="typ-punct">,</span> <span class="typ-func">str</span><span class="typ-punct">(</span>x<span class="typ-punct">)</span><span class="typ-punct">)</span><span class="typ-punct">)</span>
  <span class="typ-punct">)</span>
  New value is <span class="typ-pol">#</span><span class="typ-pol">s</span><span class="typ-punct">.</span><span class="typ-func">display</span><span class="typ-punct">(</span><span class="typ-punct">)</span>.
<span class="typ-punct">]</span>

<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;10&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x + 3&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x * 2&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x - 5&quot;</span><span class="typ-punct">)</span>
</code></pre><div class="preview"><img src="/assets/docs/a7c1c35241de9094dff62614a94e7211.png" alt="Preview" width="480" height="190"/></div></div>
<p>State managed by Typst is always updated in layout order, not in evaluation
order. The <code>update</code> method returns content and its effect occurs at the
position where the returned content is inserted into the document.</p>
<p>As a result, we can now also store some of the computations in
variables, but they still show the correct results:</p>
<div class="previewed-code"><pre><code><span class="typ-escape">...</span>

<span class="typ-key">#</span><span class="typ-key">let</span> more <span class="typ-op">=</span> <span class="typ-punct">[</span>
  <span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x * 2&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
  <span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x - 5&quot;</span><span class="typ-punct">)</span>
<span class="typ-punct">]</span>

<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;10&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x + 3&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-pol">#</span><span class="typ-pol">more</span>
</code></pre><div class="preview"><img src="/assets/docs/78648e95b2e8fa7877df7235f6305705.png" alt="Preview" width="480" height="190"/></div></div>
<p>This example is of course a bit silly, but in practice this is often exactly
what you want! A good example are heading counters, which is why Typst's
<a href="/docs/reference/introspection/counter/">counting system</a> is very similar to its state system.</p>
<h2 id="time-travel">Time Travel</h2>
<p>By using Typst's state management system you also get time travel
capabilities! By combining the state system with <a href="/docs/reference/introspection/locate/"><code>locate</code></a> and
<a href="/docs/reference/introspection/query/"><code>query</code></a>, we can find out what the value of the state will be at
any position in the document from anywhere else. In particular, the <code>at</code>
method gives us the value of the state at any location and the <code>final</code>
methods gives us the value of the state at the end of the document.</p>
<div class="previewed-code"><pre><code><span class="typ-escape">...</span>

Value at <span class="typ-raw">`&lt;here&gt;`</span> is
<span class="typ-func">#</span><span class="typ-func">locate</span><span class="typ-punct">(</span>loc <span class="typ-op">=&gt;</span> s<span class="typ-punct">.</span><span class="typ-func">at</span><span class="typ-punct">(</span>
  <span class="typ-func">query</span><span class="typ-punct">(</span><span class="typ-label">&lt;here&gt;</span><span class="typ-punct">,</span> loc<span class="typ-punct">)</span>
    <span class="typ-punct">.</span><span class="typ-func">first</span><span class="typ-punct">(</span><span class="typ-punct">)</span>
    <span class="typ-punct">.</span><span class="typ-func">location</span><span class="typ-punct">(</span><span class="typ-punct">)</span>
<span class="typ-punct">)</span><span class="typ-punct">)</span>

<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;10&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x + 3&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-strong">*Here.*</span> <span class="typ-label">&lt;here&gt;</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x * 2&quot;</span><span class="typ-punct">)</span> <span class="typ-escape">\</span>
<span class="typ-func">#</span><span class="typ-func">compute</span><span class="typ-punct">(</span><span class="typ-str">&quot;x - 5&quot;</span><span class="typ-punct">)</span>
</code></pre><div class="preview"><img src="/assets/docs/3c387c460c628cb0f84801a7b5368d5a.png" alt="Preview" width="480" height="190"/></div></div>
<h2 id="caution">A word of caution</h2>
<p>To resolve the values of all states, Typst evaluates parts of your code
multiple times. However, there is no guarantee that your state manipulation
can actually be completely resolved.</p>
<p>For instance, if you generate state updates depending on the final value of
a state, the results might never converge. The example below illustrates
this. We initialize our state with <code>1</code> and then update it to its own final
value plus 1. So it should be <code>2</code>, but then its final value is <code>2</code>, so it
should be <code>3</code>, and so on. This example display <code>4</code> because Typst simply
gives up after a few attempts.</p>
<div class="previewed-code"><pre><code><span class="typ-key">#</span><span class="typ-key">let</span> s <span class="typ-op">=</span> <span class="typ-func">state</span><span class="typ-punct">(</span><span class="typ-str">&quot;x&quot;</span><span class="typ-punct">,</span> <span class="typ-num">1</span><span class="typ-punct">)</span>
<span class="typ-func">#</span><span class="typ-func">locate</span><span class="typ-punct">(</span>loc <span class="typ-op">=&gt;</span> <span class="typ-punct">{</span>
  s<span class="typ-punct">.</span><span class="typ-func">update</span><span class="typ-punct">(</span>s<span class="typ-punct">.</span><span class="typ-func">final</span><span class="typ-punct">(</span>loc<span class="typ-punct">)</span> <span class="typ-op">+</span> <span class="typ-num">1</span><span class="typ-punct">)</span>
<span class="typ-punct">}</span><span class="typ-punct">)</span>
<span class="typ-pol">#</span><span class="typ-pol">s</span><span class="typ-punct">.</span><span class="typ-func">display</span><span class="typ-punct">(</span><span class="typ-punct">)</span>
</code></pre><div class="preview"><img src="/assets/docs/93c5bdb21387c960a7486dd14e0a7050.png" alt="Preview" width="480" height="190"/></div></div>
<p>In general, you should <em>typically</em> not generate state updates from within
<code>locate</code> calls or <code>display</code> calls of state or counters. Instead, pass a
function to <code>update</code> that determines the value of the state based on its
previous value.</p>


<h2 id="constructor">
  
<span aria-describedby="constructor-tooltip">构造函数</span>
<div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
    aria-labelledby="constructor-tooltip-qm-label">
    <title id="constructor-tooltip-qm-label">如果类型具有构造函数，可以像函数一样调用它来创建一个该类型的值。</title>
    <use href="/assets/icons/12-tooltip.svg#icon"></use>
  </svg>
  <div role="tooltip" id="constructor-tooltip" tabindex="-1">如果类型具有构造函数，可以像函数一样调用它来创建一个该类型的值。</div>
</div>

</h2>

<p>Create a new state identified by a key.</p>

<div class="code code-definition "><span
    class="typ-func">state</span>(<div class="arguments"><span
      class="overview-param"><a href="/docs/reference/types/str" class="pill pill-str">str</a>, </span><span
      class="overview-param"><a href="/docs/reference/types/any" class="pill pill-obj">any</a>, </span></div>) <!-- -->-&gt; <a href="/docs/reference/types/state" class="pill pill-obj">state</a></div>





<h4 id="constructor-state-parameters-key"><code>key</code>
  <div class="additional-info">
    <div>
      
      <a href="/docs/reference/types/str" class="pill pill-str">str</a>
      
    </div>
    <small>必需参数</small><small><span
        aria-describedby="constructor-state-parameters-key-positional-tooltip">位置参数</span>
      <div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
          aria-labelledby="constructor-state-parameters-key-positional-tooltip-qm-label">
          <title id="constructor-state-parameters-key-positional-tooltip-qm-label">
            位置参数按顺序传入，不带名称。</title>
          <use href="/assets/icons/12-tooltip.svg#icon"></use>
        </svg>
        <div role="tooltip" id="constructor-state-parameters-key-positional-tooltip"
          tabindex="-1">位置参数按顺序传入，不带名称。</div>
      </div>
    </small>
  </div>
</h4>
<p>The key that identifies this state.</p>




<h4 id="constructor-state-parameters-init"><code>init</code>
  <div class="additional-info">
    <div>
      
      <a href="/docs/reference/types/any" class="pill pill-obj">any</a>
      
    </div>
    <small><span
        aria-describedby="constructor-state-parameters-init-positional-tooltip">位置参数</span>
      <div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
          aria-labelledby="constructor-state-parameters-init-positional-tooltip-qm-label">
          <title id="constructor-state-parameters-init-positional-tooltip-qm-label">
            位置参数按顺序传入，不带名称。</title>
          <use href="/assets/icons/12-tooltip.svg#icon"></use>
        </svg>
        <div role="tooltip" id="constructor-state-parameters-init-positional-tooltip"
          tabindex="-1">位置参数按顺序传入，不带名称。</div>
      </div>
    </small>
  </div>
</h4>
<p>The initial value of the state.</p>


<p>默认：<code><span class="typ-key">none</span></code></p>









<h2 id="definitions">
  
<span aria-describedby="definitions-tooltip">定义</span>
<div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
    aria-labelledby="definitions-tooltip-qm-label">
    <title id="definitions-tooltip-qm-label">函数和类型可以有与其关联的定义 (成员或方法)。可以使用 "." 操作符来访问调用它们。</title>
    <use href="/assets/icons/12-tooltip.svg#icon"></use>
  </svg>
  <div role="tooltip" id="definitions-tooltip" tabindex="-1">函数和类型可以有与其关联的定义 (成员或方法)。可以使用 "." 操作符来访问调用它们。</div>
</div>

</h2>


  <h3 id="-display" class="method-head"><span><code>display</code></span></h3>
  
<p>Displays the current value of the state.</p>

<div class="code code-definition single-arg">self.<span
    class="typ-func">display</span>(<div class="arguments"><span
      class="overview-param"><a href="/docs/reference/types/none" class="pill pill-kw">none</a><a href="/docs/reference/types/function" class="pill pill-fn">function</a> </span></div>) <!-- -->-&gt; <a href="/docs/reference/types/content" class="pill pill-con">content</a></div>





<h4 id="definitions-display-display-parameters-func"><code>func</code>
  <div class="additional-info">
    <div>
      
      <a href="/docs/reference/types/none" class="pill pill-kw">none</a>
      
      <a href="/docs/reference/types/function" class="pill pill-fn">function</a>
      
    </div>
    <small><span
        aria-describedby="definitions-display-display-parameters-func-positional-tooltip">位置参数</span>
      <div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
          aria-labelledby="definitions-display-display-parameters-func-positional-tooltip-qm-label">
          <title id="definitions-display-display-parameters-func-positional-tooltip-qm-label">
            位置参数按顺序传入，不带名称。</title>
          <use href="/assets/icons/12-tooltip.svg#icon"></use>
        </svg>
        <div role="tooltip" id="definitions-display-display-parameters-func-positional-tooltip"
          tabindex="-1">位置参数按顺序传入，不带名称。</div>
      </div>
    </small>
  </div>
</h4>
<p>A function which receives the value of the state and can return
arbitrary content which is then displayed. If this is omitted, the
value is directly displayed.</p>


<p>默认：<code><span class="typ-key">none</span></code></p>






  <h3 id="-update" class="method-head"><span><code>update</code></span></h3>
  
<p>Update the value of the state.</p>
<p>The update will be in effect at the position where the returned content
is inserted into the document. If you don't put the output into the
document, nothing happens! This would be the case, for example, if you
write <code><span class="typ-key">let</span> _ <span class="typ-op">=</span> <span class="typ-func">state</span><span class="typ-punct">(</span><span class="typ-str">&quot;key&quot;</span><span class="typ-punct">)</span><span class="typ-punct">.</span><span class="typ-func">update</span><span class="typ-punct">(</span><span class="typ-num">7</span><span class="typ-punct">)</span></code>. State updates are always
applied in layout order and in that case, Typst wouldn't know when to
update the state.</p>

<div class="code code-definition single-arg">self.<span
    class="typ-func">update</span>(<div class="arguments"><span
      class="overview-param"><a href="/docs/reference/types/any" class="pill pill-obj">any</a><a href="/docs/reference/types/function" class="pill pill-fn">function</a><a href="/docs/reference/types/state-update" class="pill pill-obj">state-update</a> </span></div>) <!-- -->-&gt; <a href="/docs/reference/types/content" class="pill pill-con">content</a></div>





<h4 id="definitions-update-update-parameters-update"><code>update</code>
  <div class="additional-info">
    <div>
      
      <a href="/docs/reference/types/any" class="pill pill-obj">any</a>
      
      <a href="/docs/reference/types/function" class="pill pill-fn">function</a>
      
      <a href="/docs/reference/types/state-update" class="pill pill-obj">state-update</a>
      
    </div>
    <small>必需参数</small><small><span
        aria-describedby="definitions-update-update-parameters-update-positional-tooltip">位置参数</span>
      <div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
          aria-labelledby="definitions-update-update-parameters-update-positional-tooltip-qm-label">
          <title id="definitions-update-update-parameters-update-positional-tooltip-qm-label">
            位置参数按顺序传入，不带名称。</title>
          <use href="/assets/icons/12-tooltip.svg#icon"></use>
        </svg>
        <div role="tooltip" id="definitions-update-update-parameters-update-positional-tooltip"
          tabindex="-1">位置参数按顺序传入，不带名称。</div>
      </div>
    </small>
  </div>
</h4>
<p>If given a non function-value, sets the state to that value. If
given a function, that function receives the previous state and has
to return the new state.</p>







  <h3 id="-at" class="method-head"><span><code>at</code></span></h3>
  
<p>Get the value of the state at the given location.</p>

<div class="code code-definition single-arg">self.<span
    class="typ-func">at</span>(<div class="arguments"><span
      class="overview-param"><a href="/docs/reference/types/location" class="pill pill-obj">location</a> </span></div>) <!-- -->-&gt; <a href="/docs/reference/types/any" class="pill pill-obj">any</a></div>





<h4 id="definitions-at-at-parameters-location"><code>location</code>
  <div class="additional-info">
    <div>
      
      <a href="/docs/reference/types/location" class="pill pill-obj">location</a>
      
    </div>
    <small>必需参数</small><small><span
        aria-describedby="definitions-at-at-parameters-location-positional-tooltip">位置参数</span>
      <div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
          aria-labelledby="definitions-at-at-parameters-location-positional-tooltip-qm-label">
          <title id="definitions-at-at-parameters-location-positional-tooltip-qm-label">
            位置参数按顺序传入，不带名称。</title>
          <use href="/assets/icons/12-tooltip.svg#icon"></use>
        </svg>
        <div role="tooltip" id="definitions-at-at-parameters-location-positional-tooltip"
          tabindex="-1">位置参数按顺序传入，不带名称。</div>
      </div>
    </small>
  </div>
</h4>
<p>The location at which the state's value should be retrieved. A
suitable location can be retrieved from <a href="/docs/reference/introspection/locate/"><code>locate</code></a> or
<a href="/docs/reference/introspection/query/"><code>query</code></a>.</p>







  <h3 id="-final" class="method-head"><span><code>final</code></span></h3>
  
<p>Get the value of the state at the end of the document.</p>

<div class="code code-definition single-arg">self.<span
    class="typ-func">final</span>(<div class="arguments"><span
      class="overview-param"><a href="/docs/reference/types/location" class="pill pill-obj">location</a> </span></div>) <!-- -->-&gt; <a href="/docs/reference/types/any" class="pill pill-obj">any</a></div>





<h4 id="definitions-final-final-parameters-location"><code>location</code>
  <div class="additional-info">
    <div>
      
      <a href="/docs/reference/types/location" class="pill pill-obj">location</a>
      
    </div>
    <small>必需参数</small><small><span
        aria-describedby="definitions-final-final-parameters-location-positional-tooltip">位置参数</span>
      <div class="tooltip-context"><svg width="12" height="12" viewBox="0 0 12 12" tabindex="0" role="img"
          aria-labelledby="definitions-final-final-parameters-location-positional-tooltip-qm-label">
          <title id="definitions-final-final-parameters-location-positional-tooltip-qm-label">
            位置参数按顺序传入，不带名称。</title>
          <use href="/assets/icons/12-tooltip.svg#icon"></use>
        </svg>
        <div role="tooltip" id="definitions-final-final-parameters-location-positional-tooltip"
          tabindex="-1">位置参数按顺序传入，不带名称。</div>
      </div>
    </small>
  </div>
</h4>
<p>Can be an arbitrary location, as its value is irrelevant for the
method's return value. Why is it required then? As noted before,
Typst has to evaluate parts of your code multiple times to determine
the values of all state. By only allowing this method within
<a href="/docs/reference/introspection/locate/"><code>locate</code></a> calls, the amount of code that can depend on the
method's result is reduced. If you could call <code>final</code> directly at
the top level of a module, the evaluation of the whole module and
its exports could depend on the state's value.</p>










      
      <div class="page-end-buttons"><a href="/docs/reference/introspection/query/" class="previous"><img
            src="/assets/icons/16-arrow-right.svg" alt="←">
          <div><span class="page-title">Query</span><span class="hint">上一页</span></div>
        </a><a href="/docs/reference/data-loading/" class="next"><img src="/assets/icons/16-arrow-right.svg" alt="→">
          <div><span class="page-title">数据加载</span><span class="hint">下一页</span></div>
        </a></div>
      
    </main>

    
    <nav id="page-overview"><strong>目录</strong>
      <ul>
        
        <li data-assoc="summary"><a href="#summary">Summary</a>
          <ul></ul>
        </li>
        
        <li data-assoc="state-and-markup"><a href="#state-and-markup">State And Markup</a>
          <ul></ul>
        </li>
        
        <li data-assoc="state-in-typst"><a href="#state-in-typst">State In Typst</a>
          <ul></ul>
        </li>
        
        <li data-assoc="time-travel"><a href="#time-travel">Time Travel</a>
          <ul></ul>
        </li>
        
        <li data-assoc="caution"><a href="#caution">Caution</a>
          <ul></ul>
        </li>
        
        <li data-assoc="constructor"><a href="#constructor">Constructor</a>
          <ul></ul>
        </li>
        
        <li data-assoc="definitions"><a href="#definitions">Definitions</a>
          <ul></ul>
        </li>
        
      </ul>
    </nav>
    
  </div>
  <footer>
    <div>
      <ul>
        <li><a href="https://typst.app/">主页</a></li>
        <li><a href="/docs/">中文文档</a></li>
        <li><a href="https://typst.app/about/">关于我们</a></li>
        <li><a href="https://typst.app/contact/">联系</a></li>
        <li><a href="https://typst.app/privacy/">隐私</a></li>
        <li><a href="https://typst.app/terms/">服务条款</a></li>
        <li><a href="https://typst.app/legal/">法律说明</a></li>
      </ul>
    </div>
    <div>
      <ul>
        <li><a href="https://typst.app/blog/">博客</a></li>
        <li><a href="https://twitter.com/typstapp/">Twitter</a></li>
        <li><a href="https://discord.gg/2uDybryKPe">Discord</a></li>
        <li><a href="https://www.linkedin.com/company/typst/">LinkedIn</a></li>
        <li><a href="https://instagram.com/typstapp/">Instagram</a></li>
        <li><a href="https://github.com/typst-doc-cn/typst-doc-cn.github.io">GitHub</a></li>
      </ul>
    </div>
    <div>
      <p>Made in Berlin</p>
    </div>
  </footer>
  <script src="/scripts/fuse.basic.min.js"></script>
  <script src="/scripts/docs.js?bust=20230913"></script>
  <script src="/scripts/analytics.js" defer></script>
</body>

</html>